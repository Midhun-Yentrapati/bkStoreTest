<div class="manage-reviews-container">
  <h1 class="title">Manage Reviews & Ratings</h1>

  <div class="actions">
    <button class="toggle-btn" (click)="toggleReviews()">
      {{ showTable ? 'Hide Reviews' : 'Show Reviews' }}
    </button>
    <input
      *ngIf="showTable"
      type="text"
      [(ngModel)]="searchTerm"
      (ngModelChange)="onSearchChange()"
      placeholder="Search by book name..."
      class="search-input"
      aria-label="Search by book name"
    />
    <select *ngIf="showTable" [(ngModel)]="sortOption" (change)="onSortChange()" class="sort-select" aria-label="Sort by rating">
      <option value="none">Sort: Default (Newest)</option>
      <option value="ratingAsc">Rating: Low to High</option>
      <option value="ratingDesc">Rating: High to Low</option>
    </select>
  </div>

  <div *ngIf="successMessage" class="alert success">{{ successMessage }}</div>
  <div *ngIf="errorMessage" class="alert error">{{ errorMessage }}</div>

  <div *ngIf="showTable">
    <div *ngIf="isLoading" class="alert">Loading reviews...</div>

    <div *ngIf="!isLoading">
      <div *ngIf="filteredRows.length === 0" class="alert">No reviews found.</div>

      <div *ngIf="filteredRows.length > 0" class="table-wrapper">
        <table>
          <thead>
            <tr>
              <th>#</th>
              <th>Book Name</th>
              <th>Customer Name</th>
              <th>Rating</th>
              <th>Review</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let row of pagedRows; let i = index">
              <td>{{ (currentPage - 1) * pageSize + i + 1 }}</td>
              <td>{{ row.bookTitle }}</td>
              <td>{{ row.userName }}</td>
              <td>{{ row.rating }}</td>
              <td class="review" [title]="row.review">{{ row.review || '-' }}</td>
              <td>
                <button class="delete-btn" (click)="deleteReview(row)">Delete</button>
              </td>
            </tr>
          </tbody>
        </table>
        <div class="pagination" *ngIf="totalPages > 1">
          <button (click)="prevPage()" [disabled]="currentPage === 1">Prev</button>
          <button *ngFor="let p of pages" [class.active]="p === currentPage" (click)="goToPage(p)">{{ p }}</button>
          <button (click)="nextPage()" [disabled]="currentPage === totalPages">Next</button>
        </div>
      </div>
    </div>
  </div>
</div> 