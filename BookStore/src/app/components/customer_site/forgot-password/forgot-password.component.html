<!-- src/app/forgot-password/forgot-password.component.html -->

<div class="forgot-password-container">
  <div class="forgot-password-card">
    <h2>Forgot Password</h2>
    
    <!-- Email Verification Form -->
    <div *ngIf="!showResetForm">
      <p>Enter your email address to reset your password.</p>

      <form [formGroup]="forgotPasswordForm" (ngSubmit)="onSubmit()">
        <div class="form-group">
          <label for="email">Email Address:</label>
          <input
            type="email"
            id="email"
            formControlName="email"
            placeholder="Enter your email address"
            [ngClass]="{ 'is-invalid': f['email'].invalid && f['email'].touched }"
            autocomplete="email"
          />
          <div *ngIf="f['email'].invalid && f['email'].touched" class="validation-message">
            {{ getEmailErrorMessage() }}
          </div>
        </div>

        <div *ngIf="errorMessage" class="message error-message">
          {{ errorMessage }}
        </div>
        <div *ngIf="successMessage" class="message success-message">
          {{ successMessage }}
        </div>

        <button type="submit" [disabled]="!canSubmitEmailForm()">
          <span *ngIf="!isLoading">Verify Email</span>
          <span *ngIf="isLoading">Checking...</span>
        </button>
      </form>
    </div>

    <!-- Password Reset Form -->
    <div *ngIf="showResetForm">
      <p>Create a strong new password for your account.</p>

      <form [formGroup]="resetPasswordForm" (ngSubmit)="onResetPassword()">
        <div class="form-group">
          <label for="newPassword">New Password:</label>
          <div class="password-input-container">
            <input
              [type]="showPassword ? 'text' : 'password'"
              id="newPassword"
              formControlName="newPassword"
              placeholder="Enter new password"
              [ngClass]="{ 'is-invalid': rf['newPassword'].invalid && rf['newPassword'].touched }"
              autocomplete="new-password"
            />
            <button 
              type="button" 
              class="password-toggle-btn"
              (click)="togglePasswordVisibility()"
              [attr.aria-label]="showPassword ? 'Hide password' : 'Show password'"
            >
              <span *ngIf="!showPassword">👁️</span>
              <span *ngIf="showPassword">🙈</span>
            </button>
          </div>
          
          <!-- Password Strength Indicator -->
          <div class="password-strength" *ngIf="rf['newPassword'].value">
            <div class="strength-bar">
              <div 
                class="strength-fill" 
                [style.width]="passwordStrength === 'weak' ? '33%' : passwordStrength === 'medium' ? '66%' : '100%'"
                [style.background-color]="getPasswordStrengthColor()"
              ></div>
            </div>
            <span class="strength-text" [style.color]="getPasswordStrengthColor()">
              {{ getPasswordStrengthText() }}
            </span>
          </div>

          <div *ngIf="rf['newPassword'].invalid && rf['newPassword'].touched" class="validation-message">
            {{ getPasswordErrorMessage() }}
          </div>
        </div>

        <div class="form-group">
          <label for="confirmPassword">Confirm Password:</label>
          <div class="password-input-container">
            <input
              [type]="showConfirmPassword ? 'text' : 'password'"
              id="confirmPassword"
              formControlName="confirmPassword"
              placeholder="Confirm new password"
              [ngClass]="{ 'is-invalid': rf['confirmPassword'].invalid && rf['confirmPassword'].touched }"
              autocomplete="new-password"
            />
            <button 
              type="button" 
              class="password-toggle-btn"
              (click)="toggleConfirmPasswordVisibility()"
              [attr.aria-label]="showConfirmPassword ? 'Hide password' : 'Show password'"
            >
              <span *ngIf="!showConfirmPassword">👁️</span>
              <span *ngIf="showConfirmPassword">🙈</span>
            </button>
          </div>
          
          <div *ngIf="rf['confirmPassword'].invalid && rf['confirmPassword'].touched" class="validation-message">
            <div *ngIf="rf['confirmPassword'].errors?.['required']">Please confirm your password.</div>
          </div>
        </div>

        <!-- Password Requirements -->
        <div class="password-requirements">
          <h4>Password Requirements:</h4>
          <ul>
            <li [class.valid]="hasMinLength()">
              At least 8 characters long
            </li>
            <li [class.valid]="hasLowercase()">
              Contains lowercase letter (a-z)
            </li>
            <li [class.valid]="hasUppercase()">
              Contains uppercase letter (A-Z)
            </li>
            <li [class.valid]="hasNumber()">
              Contains number (0-9)
            </li>
            <li [class.valid]="hasSpecialChar()">
              Contains special character (@$!%*?&)
            </li>
          </ul>
        </div>

        <div *ngIf="resetPasswordForm.errors?.['passwordMismatch'] && rf['confirmPassword'].touched" class="validation-message">
          Passwords do not match.
        </div>

        <div *ngIf="errorMessage" class="message error-message">
          {{ errorMessage }}
        </div>
        <div *ngIf="successMessage" class="message success-message">
          {{ successMessage }}
        </div>

        <div class="button-group">
          <button type="button" class="btn-secondary" (click)="goBack()">
            Back
          </button>
          <button type="submit" [disabled]="!canSubmitPasswordForm()">
            <span *ngIf="!isLoading">Update Password</span>
            <span *ngIf="isLoading">Updating...</span>
          </button>
        </div>
      </form>
    </div>

    <div class="links" *ngIf="!showResetForm">
      <a [routerLink]="['/login']">Back to Login</a>
    </div>
  </div>
</div>
